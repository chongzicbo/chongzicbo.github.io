

<!DOCTYPE html>
<html lang="en" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">

  <link rel="apple-touch-icon" sizes="76x76" href="/img/daxiong.jpg">
  <link rel="icon" href="/img/daxiong.jpg">
  

  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="程博">
  <meta name="keywords" content="">
  
    <meta name="description" content="“MiniCPM: Unveiling the Potential of Small Language Models with Scalable Training Strategies” 由清华大学和 Modelbest Inc. 的众多研究人员共同撰写，介绍了 MiniCPM 系列小型语言模型，包括模型架构、训练方法、实验结果等，展现了其在模型和数据维度的可扩展性，以及在小型语言模型中的优势。">
<meta property="og:type" content="article">
<meta property="og:title" content="MiniCPM详解">
<meta property="og:url" content="https://chongzicbo.github.io/2024/12/20/%E4%BA%BA%E5%B7%A5%E6%99%BA%E8%83%BD/multi-modal/%E8%AE%BA%E6%96%87%E9%98%85%E8%AF%BB14%EF%BC%9AMiniCPM%E6%B7%B1%E5%85%A5%E8%A7%A3%E6%9E%90/index.html">
<meta property="og:site_name" content="程博仕">
<meta property="og:description" content="“MiniCPM: Unveiling the Potential of Small Language Models with Scalable Training Strategies” 由清华大学和 Modelbest Inc. 的众多研究人员共同撰写，介绍了 MiniCPM 系列小型语言模型，包括模型架构、训练方法、实验结果等，展现了其在模型和数据维度的可扩展性，以及在小型语言模型中的优势。">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://raw.githubusercontent.com/chongzicbo/images/main/picgo/image-20241223141035777.png">
<meta property="og:image" content="https://raw.githubusercontent.com/chongzicbo/images/main/picgo/image-20241223141106997.png">
<meta property="og:image" content="https://raw.githubusercontent.com/chongzicbo/images/main/picgo/image-20241223141919897.png">
<meta property="og:image" content="https://raw.githubusercontent.com/chongzicbo/images/main/picgo/ffd302f2750f29d6e75e666fa43c51a3-image.png">
<meta property="og:image" content="https://raw.githubusercontent.com/chongzicbo/images/main/picgo/96d5f382f6d650b0f98f618576276f19-image.png">
<meta property="og:image" content="https://raw.githubusercontent.com/chongzicbo/images/main/picgo/image-20241223143810882.png">
<meta property="og:image" content="https://raw.githubusercontent.com/chongzicbo/images/main/picgo/image-20241223144222463.png">
<meta property="og:image" content="https://raw.githubusercontent.com/chongzicbo/images/main/picgo/image-20241223144246606.png">
<meta property="og:image" content="https://raw.githubusercontent.com/chongzicbo/images/main/picgo/image-20241223144614364.png">
<meta property="og:image" content="https://raw.githubusercontent.com/chongzicbo/images/main/picgo/image-20241223144647906.png">
<meta property="og:image" content="https://raw.githubusercontent.com/chongzicbo/images/main/picgo/image-20241223145718563.png">
<meta property="og:image" content="https://raw.githubusercontent.com/chongzicbo/images/main/picgo/image-20241223153902417.png">
<meta property="og:image" content="https://raw.githubusercontent.com/chongzicbo/images/main/picgo/image-20241223153949999.png">
<meta property="og:image" content="https://raw.githubusercontent.com/chongzicbo/images/main/picgo/image-20241223154011909.png">
<meta property="og:image" content="https://raw.githubusercontent.com/chongzicbo/images/main/picgo/image-20241223154036251.png">
<meta property="og:image" content="https://raw.githubusercontent.com/chongzicbo/images/main/picgo/image-20241223154302859.png">
<meta property="og:image" content="https://raw.githubusercontent.com/chongzicbo/images/main/picgo/image-20241223154345626.png">
<meta property="og:image" content="https://raw.githubusercontent.com/chongzicbo/images/main/picgo/image-20241223154425567.png">
<meta property="og:image" content="https://raw.githubusercontent.com/chongzicbo/images/main/picgo/image-20241223154445784.png">
<meta property="og:image" content="https://raw.githubusercontent.com/chongzicbo/images/main/picgo/%E4%BA%8C%E7%BB%B4%E7%A0%81.jpg">
<meta property="article:published_time" content="2024-12-19T16:00:00.000Z">
<meta property="article:modified_time" content="2024-12-26T05:58:17.153Z">
<meta property="article:author" content="程博">
<meta property="article:tag" content="人工智能">
<meta property="article:tag" content="多模态">
<meta property="article:tag" content="论文阅读">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://raw.githubusercontent.com/chongzicbo/images/main/picgo/image-20241223141035777.png">
  
  
    <meta name="referrer" content="no-referrer-when-downgrade">
  
  
  <title>MiniCPM详解 - 程博仕</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/c/font_1749284_5i9bdhy70f8.css">



<link rel="stylesheet" href="//at.alicdn.com/t/c/font_1736178_k526ubmyhba.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"chongzicbo.github.io","root":"/","version":"1.9.8","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"left","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":true,"follow_dnt":false,"baidu":"3841b375bfdd5627f0f840e1e289416e","google":{"measurement_id":null},"tencent":{"sid":null,"cid":null},"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false},"umami":{"src":null,"website_id":null,"domains":null,"start_time":"2024-01-01T00:00:00.000Z","token":null,"api_server":null}},"search_path":"/local-search.xml","include_content_in_search":true};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  

  
    <!-- Baidu Analytics -->
    <script async>
      if (!Fluid.ctx.dnt) {
        var _hmt = _hmt || [];
        (function() {
          var hm = document.createElement("script");
          hm.src = "https://hm.baidu.com/hm.js?3841b375bfdd5627f0f840e1e289416e";
          var s = document.getElementsByTagName("script")[0];
          s.parentNode.insertBefore(hm, s);
        })();
      }
    </script>
  

  

  

  

  



  
<meta name="generator" content="Hexo 7.3.0"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>程博仕</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/" target="_self">
                <i class="iconfont icon-home-fill"></i>
                <span>Home</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item dropdown">
              <a class="nav-link dropdown-toggle" target="_self" href="javascript:;" role="button"
                 data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                <i class="iconfont icon-category-fill"></i>
                <span>人工智能</span>
              </a>
              <div class="dropdown-menu" aria-labelledby="navbarDropdown">
                
                  
                  
                  
                  <a class="dropdown-item" href="/categories/%E4%BA%BA%E5%B7%A5%E6%99%BA%E8%83%BD/nlp" target="_self">
                    
                    <span>自然语言处理</span>
                  </a>
                
                  
                  
                  
                  <a class="dropdown-item" href="/categories/%E4%BA%BA%E5%B7%A5%E6%99%BA%E8%83%BD/computer-vision" target="_self">
                    
                    <span>计算机视觉</span>
                  </a>
                
                  
                  
                  
                  <a class="dropdown-item" href="/categories/%E4%BA%BA%E5%B7%A5%E6%99%BA%E8%83%BD/multi-modal" target="_self">
                    
                    <span>多模态</span>
                  </a>
                
                  
                  
                  
                  <a class="dropdown-item" href="/categories/%E4%BA%BA%E5%B7%A5%E6%99%BA%E8%83%BD/asr" target="_self">
                    
                    <span>语音识别</span>
                  </a>
                
              </div>
            </li>
          
        
          
          
          
          
            <li class="nav-item dropdown">
              <a class="nav-link dropdown-toggle" target="_self" href="javascript:;" role="button"
                 data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                <i class="iconfont icon-category-fill"></i>
                <span>开发</span>
              </a>
              <div class="dropdown-menu" aria-labelledby="navbarDropdown">
                
                  
                  
                  
                  <a class="dropdown-item" href="/categories/%E5%BC%80%E5%8F%91/%E9%9F%B3%E8%A7%86%E9%A2%91" target="_self">
                    
                    <span>音视频</span>
                  </a>
                
                  
                  
                  
                  <a class="dropdown-item" href="/categories/%E5%BC%80%E5%8F%91/web&#39;" target="_self">
                    
                    <span>Web开发</span>
                  </a>
                
                  
                  
                  
                  <a class="dropdown-item" href="/categories/%E5%BC%80%E5%8F%91/cpp" target="_self">
                    
                    <span>C++</span>
                  </a>
                
                  
                  
                  
                  <a class="dropdown-item" href="/categories/%E5%BC%80%E5%8F%91/java" target="_self">
                    
                    <span>Java</span>
                  </a>
                
                  
                  
                  
                  <a class="dropdown-item" href="/categories/%E5%BC%80%E5%8F%91/python" target="_self">
                    
                    <span>Python</span>
                  </a>
                
              </div>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/" target="_self">
                <i class="iconfont icon-category-fill"></i>
                <span>文章分类</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/" target="_self">
                <i class="iconfont icon-archive-fill"></i>
                <span>时间轴</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/" target="_self">
                <i class="iconfont icon-tags-fill"></i>
                <span>Tags</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/" target="_self">
                <i class="iconfont icon-user-fill"></i>
                <span>About</span>
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              <i class="iconfont icon-search"></i>
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">
              <i class="iconfont icon-dark" id="color-toggle-icon"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/img/default.png') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="MiniCPM详解"></span>
          
        </div>

        
          
  <div class="mt-3">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-author" aria-hidden="true"></i>
        程博
      </span>
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2024-12-20 00:00" pubdate>
          December 20, 2024 am
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          7.5k words
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          63 mins
        
      </span>
    

    
    
      
        <span id="busuanzi_container_page_pv" style="display: none">
          <i class="iconfont icon-eye" aria-hidden="true"></i>
          <span id="busuanzi_value_page_pv"></span> views
        </span>
        

      
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="padding-left: 2rem; margin-right: -1rem">
    <div id="toc">
  <p class="toc-header">
    <i class="iconfont icon-list"></i>
    <span>Table of Contents</span>
  </p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <h1 id="seo-header">MiniCPM详解</h1>
            
              <p id="updated-time" class="note note-info" style="">
                
                  
                    Last updated on December 26, 2024 pm
                  
                
              </p>
            
            
              <div class="markdown-body">
                
                <p>“MiniCPM: Unveiling the Potential of Small Language Models with Scalable Training Strategies” 由清华大学和 Modelbest Inc. 的众多研究人员共同撰写，介绍了 MiniCPM 系列小型语言模型，包括模型架构、训练方法、实验结果等，展现了其在模型和数据维度的可扩展性，以及在小型语言模型中的优势。</p>
<h2 id="1-研究背景"><a href="#1-研究背景" class="headerlink" title="1. 研究背景"></a>1. 研究背景</h2><h3 id="1-1-之前研究存在的问题"><a href="#1-1-之前研究存在的问题" class="headerlink" title="1.1 之前研究存在的问题"></a>1.1 之前研究存在的问题</h3><p>近年来，大型语言模型（LLMs）如GPT-3、PaLM等在自然语言处理领域取得了显著的进展。这些模型通常拥有数十亿甚至上万亿的参数，能够处理复杂的任务并展现出强大的泛化能力。然而，训练和部署这些大型模型面临着巨大的资源消耗和成本问题。例如，训练一个万亿参数的模型需要大量的计算资源和能源，且在实际应用中，这些模型的部署也面临着效率和可行性的挑战。</p>
<h3 id="1-2-研究难点"><a href="#1-2-研究难点" class="headerlink" title="1.2 研究难点"></a>1.2 研究难点</h3><p>尽管大型模型的性能令人印象深刻，但其高昂的训练成本和资源消耗使得许多研究者和企业难以负担。此外，这些模型在实际应用中的部署也面临着诸多限制，尤其是在资源受限的设备上，如个人电脑或智能手机。因此，如何在不牺牲性能的前提下，开发出资源效率更高的小型语言模型（SLMs）成为了当前研究的一个重要方向。</p>
<h3 id="1-3-相关工作总结"><a href="#1-3-相关工作总结" class="headerlink" title="1.3 相关工作总结"></a>1.3 相关工作总结</h3><p>近年来，小型语言模型（SLMs）的研究逐渐受到关注。一些研究者提出了通过数据优化、模型剪枝和架构重构等方法来提升SLMs的性能。例如，Phi系列、TinyLlama、MobileLLM等模型通过高质量数据和结构优化，展示了SLMs在特定任务上的潜力。然而，这些模型在综合能力上仍然难以与大型模型相媲美，且缺乏透明和可扩展的训练方法。</p>
<h2 id="2-研究方法"><a href="#2-研究方法" class="headerlink" title="2. 研究方法"></a>2. 研究方法</h2><h3 id="2-1-模型风洞实验"><a href="#2-1-模型风洞实验" class="headerlink" title="2.1 模型风洞实验"></a>2.1 模型风洞实验</h3><h4 id="Scaling-Hyper-parameters-Invariant-LM"><a href="#Scaling-Hyper-parameters-Invariant-LM" class="headerlink" title="Scaling Hyper-parameters Invariant LM"></a>Scaling Hyper-parameters Invariant LM</h4><p>Scaling Hyper-parameters Invariant LM（缩放超参数不变的语言模型）是一种旨在通过调整模型的超参数来实现不同规模模型的性能稳定的方法。这种方法的核心思想是利用Tensor Program框架中的宽度缩放和深度缩放技术，以预测大型语言模型（LLMs）的损失，并确保在不同规模的模型上获得最佳的学习率。</p>
<p>在MiniCPM中，作者采用了Tensor Program的这两种缩放技术：</p>
<ol>
<li><p><strong>宽度缩放（Width Scaling）</strong>：这种技术通过调整模型的隐藏层维度来改变模型的宽度。在MiniCPM中，宽度缩放被应用于所有模型，包括MiniCPM-1.2B和MiniCPM-2.4B。</p>
</li>
<li><p><strong>深度缩放（Depth Scaling）</strong>：这种技术通过增加模型的层数来改变模型的深度。尽管Yang等人在2023年的研究中观察到，当网络块深度大于2时，深度缩放的效果不理想，但作者在实践中发现，对于MiniCPM模型，深度缩放仍然能够带来稳定的学习率。</p>
</li>
</ol>
<p>此外，作者没有采用注意力softmax缩放技术，因为他们在实践中发现，即使不使用这种技术，模型的学习率仍然是稳定的。</p>
<p>通过这些缩放技术，MiniCPM能够在不同规模的模型上实现超参数的稳定性和一致性，从而提高模型的训练效率和性能。</p>
<p><img src="https://raw.githubusercontent.com/chongzicbo/images/main/picgo/image-20241223141035777.png" srcset="/img/loading.gif" lazyload alt="image-20241223141035777"></p>
<p><img src="https://raw.githubusercontent.com/chongzicbo/images/main/picgo/image-20241223141106997.png" srcset="/img/loading.gif" lazyload alt="image-20241223141106997"></p>
<h4 id="最优批量大小"><a href="#最优批量大小" class="headerlink" title="最优批量大小"></a>最优批量大小</h4><p>在”3.2 Optimal Batch Size”部分，论文探讨了批量大小（batch size）对模型训练的影响以及如何确定最佳的批量大小。批量大小决定了模型在每次迭代中处理的数据量，它直接影响模型的收敛速度和计算资源的消耗。以下是该部分的几个主要观点：</p>
<ol>
<li><p><strong>批量大小与收敛速度和资源消耗的平衡</strong>：</p>
<ul>
<li>如果批量大小过大，会导致大量的数据和计算成本。</li>
<li>如果批量大小过小，则需要更多的训练步骤，可能导致损失函数下降有限。</li>
</ul>
</li>
<li><p><strong>实验设置</strong>：</p>
<ul>
<li>论文在三个不同大小的模型上进行了实验：0.009B、0.03B 和 0.17B。</li>
<li>每个模型在六个不同的批量大小上进行训练，全局学习率为0.01，使用余弦学习率调度器。</li>
</ul>
</li>
<li><p><strong>观察到的趋势</strong>：</p>
<ul>
<li>批量大小与损失之间的关系显示，随着损失的减少，最佳批量大小会增大。</li>
<li>通过拟合等损失点，发现批量大小与损失之间存在线性关系。</li>
</ul>
</li>
<li><p><strong>公式推导</strong>：</p>
<ul>
<li>论文提出了一个公式来描述批量大小（bs）与C4数据集上的损失（L）之间的关系：<br>$$<br>bs&#x3D;\frac{1.21\times10^{9}}{L^{6.24}}<br>$$</li>
</ul>
</li>
</ol>
<p>总的来说，论文通过实验和分析，展示了如何根据预期的损失来确定最佳批量大小，并提出了一个基于损失预测的批量大小估计方法。</p>
<p><img src="https://raw.githubusercontent.com/chongzicbo/images/main/picgo/image-20241223141919897.png" srcset="/img/loading.gif" lazyload alt="image-20241223141919897"></p>
<h4 id="最优学习率"><a href="#最优学习率" class="headerlink" title="最优学习率"></a>最优学习率</h4><p>由于我们使用了张量程序（Yang等人，2022年；2023年），我们预计学习率在模型扩展期间不会发生显著变化。为了验证这一点，我们在0.04B、0.1B、0.3B和0.5B的六个学习率实验中进行测试。在图3中，我们发现尽管模型大小增加了十倍，最优基础学习率2并没有明显变化，保持在大约0.01左右。我们进一步在2.1B的规模上进行简单验证，确认0.01的学习率确实实现了最低损失。</p>
<p><img src="https://raw.githubusercontent.com/chongzicbo/images/main/picgo/ffd302f2750f29d6e75e666fa43c51a3-image.png" srcset="/img/loading.gif" lazyload alt="图3：损失与学习率的关系。在应用张量程序后，学习率的变动变得非常小。"></p>
<h3 id="2-2-WSD-学习率调度器（LRS）"><a href="#2-2-WSD-学习率调度器（LRS）" class="headerlink" title="2.2 WSD 学习率调度器（LRS）"></a>2.2 WSD 学习率调度器（LRS）</h3><h4 id="分析-Cosine-LRS"><a href="#分析-Cosine-LRS" class="headerlink" title="分析 Cosine LRS"></a>分析 Cosine LRS</h4><p><img src="https://raw.githubusercontent.com/chongzicbo/images/main/picgo/96d5f382f6d650b0f98f618576276f19-image.png" srcset="/img/loading.gif" lazyload alt="图4：具有不同周期的余弦学习率调度器。Y轴是C4语料库上的损失。"></p>
<p>在”4.1 Analysing Cosine LRS”小节中，论文分析了余弦学习率调度器（Cosine LRS）的关键特性和其对模型性能的影响。以下是该小节的主要内容：</p>
<ol>
<li><p><strong>余弦学习率调度器的基本原理</strong>：</p>
<ul>
<li>余弦学习率调度器（Cosine LRS）是一种常用的学习率调整策略，它在训练过程中逐渐降低学习率，遵循余弦曲线的变化。具体来说，学习率在预热阶段达到最大值后，按照余弦函数的形状逐渐下降。</li>
</ul>
</li>
<li><p><strong>关键超参数</strong>：</p>
<ul>
<li>余弦学习率调度器的一个关键超参数是步长 $T$，即余弦函数首次降到最小值的时间点。通常，$T$ 被设置为总训练步数 $S$。</li>
</ul>
</li>
<li><p><strong>实验验证</strong>：</p>
<ul>
<li>论文通过在0.036B模型上进行实验，验证了不同 $T$ 值对学习率调度器性能的影响。实验结果表明，当 $T&#x3D;S$ 时，模型的损失最低。这表明在整个训练过程中保持较高的学习率有助于模型找到更好的全局最优解。</li>
<li>当 $T&lt;S$ 或 $T&gt;S$ 时，模型的性能不如 $T&#x3D;S$ 时的表现。特别是，$T&gt;S$ 会导致性能下降。</li>
</ul>
</li>
<li><p><strong>假设分析</strong>：</p>
<ul>
<li>论文提出了两个假设来解释为什么 $T&#x3D;S$ 时余弦学习率调度器表现优异：<ol>
<li>当 $T&#x3D;S$ 时，高学习率训练的持续时间更长，这有助于模型找到更好的全局最优解。</li>
<li>当 $T&#x3D;S$ 时，学习率衰减阶段更为彻底，这可能涉及独特的训练动态，使模型能够找到更好的局部最优解。</li>
</ol>
</li>
</ul>
</li>
<li><p><strong>实验结果</strong>：</p>
<ul>
<li>实验结果显示，在 $T&#x3D;S$ 时，余弦学习率调度器的性能最佳。具体来说，当训练步数为 $S&#x3D;20N, 40N, 60N, 80N$ 时，损失总是由 $\operatorname{Cosine}(T)$ 达到最低，而不是 $\operatorname{Cosine}(T)$ 或 $\operatorname{CosineLoop}(T)$。</li>
</ul>
</li>
</ol>
<p>通过这些分析，论文强调了余弦学习率调度器在特定条件下（即 $T&#x3D;S$）的优越性，并为后续提出的WSD（Warmup-Stable-Decay）学习率调度器奠定了基础。</p>
<h4 id="提出-WSD-LRS"><a href="#提出-WSD-LRS" class="headerlink" title="提出 WSD LRS"></a>提出 WSD LRS</h4><p>在”4.2 WSD LRS”小节中，论文提出了一种新的学习率调度器，称为Warmup-Stable-Decay (WSD) 学习率调度器。以下是该小节的主要内容：</p>
<h5 id="引言"><a href="#引言" class="headerlink" title="引言"></a>引言</h5><ul>
<li><strong>背景</strong>：现有的学习率调度器（如Cosine LRS）在训练过程中逐渐降低学习率，但在某些情况下，可能需要更灵活的调度策略来优化模型性能。</li>
<li><strong>目标</strong>：提出一种新的学习率调度器，能够在训练的不同阶段有效地调整学习率，以提高模型的训练效率和性能。</li>
</ul>
<h5 id="WSD-LRS的定义"><a href="#WSD-LRS的定义" class="headerlink" title="WSD LRS的定义"></a>WSD LRS的定义</h5><ul>
<li><strong>定义</strong>：WSD LRS将训练过程分为三个阶段：预热阶段（Warmup）、稳定阶段（Stable）和衰减阶段（Decay）。</li>
<li><strong>公式</strong>：<br>$$<br>WSD(T; s)&#x3D;\left{\begin{array}{l}<br>\frac{s}{W}\eta,\quad s&lt;W\<br>\eta,\quad W&lt;s&lt;T\<br>f(s-T)\eta,\quad T&lt;s&lt;S<br>\end{array}\right.<br>$$<br>其中，$0&lt;f(s-T)\leq 1$ 是一个关于 $s$ 的递减函数，$\eta$ 是最大学习率。</li>
</ul>
<h5 id="实验验证"><a href="#实验验证" class="headerlink" title="实验验证"></a>实验验证</h5><ul>
<li><strong>损失下降</strong>：在0.036B模型上使用WSD LRS进行实验，结果显示在衰减阶段，随着学习率的降低，损失显著下降，并且很快达到或低于Cosine LRS在步长 $T&#x3D;S$ 时的表现。</li>
</ul>
<p><img src="https://raw.githubusercontent.com/chongzicbo/images/main/picgo/image-20241223143810882.png" srcset="/img/loading.gif" lazyload alt="image-20241223143810882"></p>
<ul>
<li><strong>快速测试</strong>：缩短衰减阶段可以加快不同模型检查点的快速测试。实验表明，使用10%的总标记数进行衰减足以达到最佳效果。</li>
</ul>
<h5 id="数据扩展的有效性"><a href="#数据扩展的有效性" class="headerlink" title="数据扩展的有效性"></a>数据扩展的有效性</h5><ul>
<li><strong>连续训练</strong>：使用WSD LRS可以持续训练固定大小的模型到极端收敛。实验比较了连续训练0.036B模型和使用40N数据的0.17B模型的性能，结果显示0.036B模型在增加约4倍的训练计算量的情况下，可以达到与0.17B模型相当的性能，同时节省了约5倍的推理计算量。</li>
</ul>
<h4 id="衰减阶段的分析"><a href="#衰减阶段的分析" class="headerlink" title="衰减阶段的分析"></a>衰减阶段的分析</h4><p><img src="https://raw.githubusercontent.com/chongzicbo/images/main/picgo/image-20241223144222463.png" srcset="/img/loading.gif" lazyload alt="image-20241223144222463"></p>
<p><img src="https://raw.githubusercontent.com/chongzicbo/images/main/picgo/image-20241223144246606.png" srcset="/img/loading.gif" lazyload alt="image-20241223144246606"></p>
<p>在”4.4 Analysis of the Decay Stage”部分，论文对MiniCPM-2.4B模型在衰减阶段的训练过程进行了详细分析。以下是该部分的几个主要分析点：</p>
<ol>
<li><p><strong>权重更新与损失的关系</strong>：</p>
<ul>
<li>研究者计算了MiniCPM-2.4B模型中所有权重矩阵的最大权重元素更新。结果显示，权重更新与学习率的幅度之间存在强相关性。具体来说，在学习率衰减之前，模型检查点经历了显著的权重更新，但损失几乎没有减少。相反，在衰减阶段，尽管权重更新的幅度较小，损失却迅速下降。</li>
</ul>
</li>
<li><p><strong>梯度信息的分析</strong>：</p>
<ul>
<li>研究者记录了0.2B模型的每一步梯度信息，并评估了连续步骤之间的差异，以近似二阶梯度信息。结果显示，梯度范数在衰减阶段减小，梯度之间的角度余弦值主要为正值，表明在衰减阶段，模型参数在每一步都是一致变化的。</li>
<li>一阶梯度在每一步显著减小，与学习率的变化密切相关。二阶梯度的幅度略有增加，表明损失函数的曲率增大，接近局部最优解。</li>
</ul>
</li>
<li><p><strong>优化过程的几何解释</strong>：</p>
<ul>
<li>研究者将优化过程视为在高维流形上的轨迹，并计算了一阶和二阶梯向导数。结果显示，一阶梯向导数与学习率成指数衰减，而二阶梯向导数的幅度略有增加。这表明在衰减阶段，模型参数的变化更加一致，损失函数的曲率增大，接近局部最优解。</li>
</ul>
</li>
<li><p><strong>实验结果的可视化</strong>：</p>
<ul>
<li>图7展示了权重更新的最大差异，图8展示了梯度统计信息。这些图表直观地展示了在衰减阶段，尽管权重更新的幅度较小，但损失迅速下降的现象。</li>
</ul>
</li>
</ol>
<p>通过这些分析，研究者揭示了在衰减阶段，MiniCPM-2.4B模型的训练动态具有独特的特征，这些特征有助于模型更快地收敛到局部最优解。这些发现为进一步优化模型训练过程提供了重要的见解。</p>
<h4 id="缩放定律的测量"><a href="#缩放定律的测量" class="headerlink" title="缩放定律的测量"></a>缩放定律的测量</h4><p><img src="https://raw.githubusercontent.com/chongzicbo/images/main/picgo/image-20241223144614364.png" srcset="/img/loading.gif" lazyload alt="image-20241223144614364"></p>
<p><img src="https://raw.githubusercontent.com/chongzicbo/images/main/picgo/image-20241223144647906.png" srcset="/img/loading.gif" lazyload alt="image-20241223144647906"></p>
<p>在”4.5 Measuring the Scaling Law with WSD LRS”部分，论文介绍了如何利用WSD（Warmup-Stable-Decay）学习率调度器来高效地研究大规模语言模型（LLMs）的规模定律。以下是该部分的详细介绍和分析：</p>
<h5 id="1-规模定律的重要性"><a href="#1-规模定律的重要性" class="headerlink" title="1. 规模定律的重要性"></a>1. 规模定律的重要性</h5><p>规模定律是指导LLMs发展的重要原则，它描述了模型规模和数据规模之间的关系。Kaplan等人（2020）和Hoffmann等人（2022）分别提出了不同的规模定律模型，前者认为模型规模增加十倍应对应数据规模增加一倍，而后者则认为两者应同比例增加。</p>
<h5 id="2-传统规模实验的挑战"><a href="#2-传统规模实验的挑战" class="headerlink" title="2. 传统规模实验的挑战"></a>2. 传统规模实验的挑战</h5><p>传统的规模实验需要在不同模型规模和数据规模上进行多次训练，计算成本高昂，时间复杂度为$O(m^2 C)$，其中$m$是模型数量，$C$是每次训练的成本。</p>
<h5 id="3-WSD调度器的优势"><a href="#3-WSD调度器的优势" class="headerlink" title="3. WSD调度器的优势"></a>3. WSD调度器的优势</h5><p>WSD调度器允许在稳定阶段的任意检查点开始衰减，从而在不需要从头开始训练的情况下，精确测量规模定律。这使得规模定律的测量在数据轴上具有线性成本$O(m C)$，大大提高了效率。</p>
<h5 id="4-实验设计"><a href="#4-实验设计" class="headerlink" title="4. 实验设计"></a>4. 实验设计</h5><ul>
<li><strong>模型和数据规模</strong>：研究者在6个不同规模的模型（从0.04B到2B）上进行了实验，每个模型在稳定阶段的6个不同检查点（从10N到60N数据）开始衰减。</li>
<li><strong>训练和评估</strong>：每个模型在五个独立的评估数据集上进行最终损失评估。为了公平比较，损失按字节数而非标记数平均。</li>
</ul>
<h5 id="5-规模定律的拟合"><a href="#5-规模定律的拟合" class="headerlink" title="5. 规模定律的拟合"></a>5. 规模定律的拟合</h5><ul>
<li><strong>拟合公式</strong>：研究者使用Hoffmann等人（2022）提出的公式来拟合损失与模型规模和数据规模的关系：<br>$$<br>L(N, D) &#x3D; C_N N^{-\alpha} + C_D D^{-\beta} + L_0<br>$$<br>其中，$N$和$D$分别是模型规模和数据规模，$C_N$和$C_D$是常数，$\alpha$和$\beta$是指数，$L_0$是常数项。</li>
<li><strong>最优模型和数据规模</strong>：通过拟合，研究者得到了每个数据集和检查点的最优模型规模$N_{\text{opt}}$和数据规模$D_{\text{opt}}$，并计算了数据-模型比例$\frac{D_{\text{opt}}}{N_{\text{opt}}}$。</li>
</ul>
<h5 id="6-结果分析"><a href="#6-结果分析" class="headerlink" title="6. 结果分析"></a>6. 结果分析</h5><ul>
<li><strong>数据-模型比例</strong>：研究结果表明，数据-模型比例比Hoffmann等人（2022）的结果高得多，平均约为192倍，而不是20倍。这表明较小的模型可以吸收更多的数据，从而提高推理和部署的效率。</li>
<li><strong>与Chinchilla Optimal的比较</strong>：尽管与Chinchilla Optimal的结果存在较大差异，但通过与Llama2的比较，研究者认为WSD调度器在更现代的配置下可能具有更高的数据-模型比例。</li>
</ul>
<h5 id="7-未来方向"><a href="#7-未来方向" class="headerlink" title="7. 未来方向"></a>7. 未来方向</h5><ul>
<li><strong>进一步研究</strong>：研究者计划深入分析衰减阶段的损失下降原因，并通过扩大模型和数据规模来增强MiniCPM的能力。</li>
</ul>
<h5 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h5><p>通过引入WSD调度器，论文提出了一种高效的方法来研究LLMs的规模定律，显著降低了计算成本。研究结果表明，较小的模型可以吸收更多的数据，从而提高推理和部署的效率。未来的研究将进一步探索WSD调度器在其他模型上的应用及其对规模定律的影响。</p>
<h2 id="3-两阶段预训练策略"><a href="#3-两阶段预训练策略" class="headerlink" title="3. 两阶段预训练策略"></a>3. 两阶段预训练策略</h2><p>论文提出了一种两阶段的预训练策略，旨在提高小型语言模型（SLMs）的性能。以下是对该章节的详细总结和分析：</p>
<h3 id="3-1-背景与动机"><a href="#3-1-背景与动机" class="headerlink" title="3.1 背景与动机"></a>3.1 背景与动机</h3><ul>
<li><strong>背景</strong>：大型语言模型（LLMs）的训练成本高昂，且在个人电脑或智能手机等终端设备上部署效率低下。</li>
<li><strong>动机</strong>：探索小型语言模型（SLMs）作为资源高效的替代方案，并通过可扩展的训练策略，使其具备与大型模型相似的能力。</li>
</ul>
<h3 id="3-2-两阶段预训练策略"><a href="#3-2-两阶段预训练策略" class="headerlink" title="3.2 两阶段预训练策略"></a>3.2 两阶段预训练策略</h3><ul>
<li><p><strong>阶段划分</strong>：</p>
<ul>
<li><strong>第一阶段</strong>：仅使用大规模、低质量的预训练数据进行训练。</li>
<li><strong>第二阶段</strong>：在衰减阶段引入高质量、知识导向的监督微调（SFT）数据，混合到预训练数据中。</li>
</ul>
</li>
<li><p><strong>优势</strong>：</p>
<ul>
<li><strong>全面学习</strong>：在衰减阶段引入高质量数据，促进模型在更接近实际用户场景的数据分布上进行更显著的损失减少。</li>
<li><strong>持续训练</strong>：避免在整个预训练过程中均匀分布高质量数据，集中资源和持续预训练。</li>
</ul>
</li>
</ul>
<h3 id="3-3-实验验证"><a href="#3-3-实验验证" class="headerlink" title="3.3 实验验证"></a>3.3 实验验证</h3><p><img src="https://raw.githubusercontent.com/chongzicbo/images/main/picgo/image-20241223145718563.png" srcset="/img/loading.gif" lazyload alt="image-20241223145718563"></p>
<ul>
<li><p><strong>实验设置</strong>：</p>
<ul>
<li><strong>模型选择</strong>：使用MiniCPM-2.4B和MiniCPM-1.2B模型。</li>
<li><strong>对比实验</strong>：<ul>
<li>A-1：2.4B模型，仅使用预训练数据进行衰减，随后进行4B标记的SFT。</li>
<li>A-2：2.4B模型，在衰减阶段混合高质量数据和SFT数据，随后进行4B标记的SFT。</li>
<li>B-1：1.2B模型，仅使用预训练数据进行衰减，随后进行6B标记的SFT。</li>
<li>B-2：1.2B模型，仅使用预训练数据进行衰减，随后进行12B标记的SFT。</li>
<li>B-3：1.2B模型，在衰减阶段混合高质量数据和SFT数据，随后进行6B标记的SFT。</li>
</ul>
</li>
</ul>
</li>
<li><p><strong>结果分析</strong>：</p>
<ul>
<li><strong>A-2 vs A-1</strong>：尽管A-2和A-1在SFT阶段使用相同的数据分布，但A-2在衰减阶段引入高质量数据，显著提升了模型性能。</li>
<li><strong>B-3 vs B-2</strong>：B-3在衰减阶段引入高质量数据，表现优于仅在SFT阶段引入高质量数据的B-2。</li>
</ul>
</li>
</ul>
<h3 id="3-4-结论"><a href="#3-4-结论" class="headerlink" title="3.4 结论"></a>3.4 结论</h3><ul>
<li><strong>策略有效性</strong>：引入高质量数据到衰减阶段比仅在SFT阶段引入数据更能提升模型性能。</li>
<li><strong>推荐</strong>：建议从衰减阶段开始，专门化和增强模型能力。</li>
</ul>
<h3 id="总结-1"><a href="#总结-1" class="headerlink" title="总结"></a>总结</h3><p>论文提出的两阶段预训练策略通过在不同阶段引入不同类型的数据，显著提升了小型语言模型的性能。该策略不仅提高了模型的学习效率，还为未来的大型语言模型开发提供了有价值的参考。</p>
<h2 id="4-MiniCPM-模型"><a href="#4-MiniCPM-模型" class="headerlink" title="4. MiniCPM 模型"></a>4. MiniCPM 模型</h2><p>第6章节“6 Model”详细介绍了MiniCPM模型的各个方面，包括模型细节、训练阶段、训练数据分布、训练损失和模型评估。以下是各部分的详细介绍：</p>
<h3 id="4-1-Model-Details"><a href="#4-1-Model-Details" class="headerlink" title="4.1 Model Details"></a>4.1 Model Details</h3><p><img src="https://raw.githubusercontent.com/chongzicbo/images/main/picgo/image-20241223153902417.png" srcset="/img/loading.gif" lazyload alt="image-20241223153902417"></p>
<h4 id="词汇"><a href="#词汇" class="headerlink" title="词汇"></a>词汇</h4><ul>
<li><strong>MiniCPM-2.4B</strong>：使用122,753词汇大小的tokenizer。</li>
<li><strong>MiniCPM-1.2B</strong>：使用73,440词汇大小的tokenizer，较小的词汇表有利于效率而不显著影响性能。</li>
</ul>
<h4 id="共享输入输出层"><a href="#共享输入输出层" class="headerlink" title="共享输入输出层"></a>共享输入输出层</h4><ul>
<li>为了减少参数空间，MiniCPM-2.4B和MiniCPM-1.2B都使用了嵌入共享技术。</li>
</ul>
<h4 id="深而薄的网络"><a href="#深而薄的网络" class="headerlink" title="深而薄的网络"></a>深而薄的网络</h4><ul>
<li><strong>MiniCPM-2.4B</strong>：在训练MiniCPM-1.2B之前，采用了更深更薄的网络架构。</li>
<li><strong>MiniCPM-1.2B</strong>：进一步加深和变薄，以适应长上下文任务。</li>
</ul>
<h4 id="组查询注意力"><a href="#组查询注意力" class="headerlink" title="组查询注意力"></a>组查询注意力</h4><ul>
<li><strong>MiniCPM-2.4B</strong>：未修改注意力层。</li>
<li><strong>MiniCPM-1.2B</strong>：应用了组查询注意力（Group Query Attention）以减少参数数量。</li>
</ul>
<h3 id="4-2-Training-Stages"><a href="#4-2-Training-Stages" class="headerlink" title="4.2 Training Stages"></a>4.2 Training Stages</h3><h4 id="稳定训练阶段"><a href="#稳定训练阶段" class="headerlink" title="稳定训练阶段"></a>稳定训练阶段</h4><ul>
<li>使用约1T的数据，主要来自开放数据集。</li>
<li>使用WSD学习率调度器，批量大小为3.93百万，最大学习率为0.01。</li>
</ul>
<h4 id="衰减阶段"><a href="#衰减阶段" class="headerlink" title="衰减阶段"></a>衰减阶段</h4><ul>
<li>使用预训练数据和高质量的SFT数据混合。</li>
<li>采用指数衰减形式，T设为5000步（20B标记）。</li>
</ul>
<h4 id="SFT阶段"><a href="#SFT阶段" class="headerlink" title="SFT阶段"></a>SFT阶段</h4><ul>
<li>使用类似衰减阶段的数据，但不包括预训练数据，训练约60亿标记。</li>
<li>学习率与衰减阶段末尾相同，使用WSD调度器。</li>
</ul>
<h3 id="4-3-Training-Data-Distribution"><a href="#4-3-Training-Data-Distribution" class="headerlink" title="4.3 Training Data Distribution"></a>4.3 Training Data Distribution</h3><p><img src="https://raw.githubusercontent.com/chongzicbo/images/main/picgo/image-20241223153949999.png" srcset="/img/loading.gif" lazyload alt="image-20241223153949999"></p>
<ul>
<li><strong>稳定阶段</strong>：主要使用开放数据集，如CommonCrawl、Dolma、C4、Pile、Code Pre-train等。</li>
<li><strong>衰减阶段</strong>：数据混合包含更多样化和专有的数据，如UltraChat、SlimOrca、OssInstruct、EvolInstruct等。</li>
</ul>
<h3 id="4-4-Training-Loss"><a href="#4-4-Training-Loss" class="headerlink" title="4.4 Training Loss"></a>4.4 Training Loss</h3><p><img src="https://raw.githubusercontent.com/chongzicbo/images/main/picgo/image-20241223154011909.png" srcset="/img/loading.gif" lazyload alt="image-20241223154011909"></p>
<ul>
<li>在C4数据集上的整体训练损失显示，衰减阶段的损失显著下降。</li>
<li>由于使用指数衰减，学习率降至最大值的10%以下后，损失仍继续下降，但最终检查点未用于微调。</li>
</ul>
<h3 id="4-5-Evaluation"><a href="#4-5-Evaluation" class="headerlink" title="4.5 Evaluation"></a>4.5 Evaluation</h3><p><img src="https://raw.githubusercontent.com/chongzicbo/images/main/picgo/image-20241223154036251.png" srcset="/img/loading.gif" lazyload alt="image-20241223154036251"></p>
<ul>
<li>使用开源工具UltraEval进行评估，支持多种主流大型模型的性能评估。</li>
<li>评估数据集包括MMLU、CMMLU、C-Eval、MBPP、GSM8K、MATH、HumanEval、BBH等。</li>
<li>评估方法包括标准化输入提示和调整输入输出模板，确保公平比较。</li>
</ul>
<h4 id="评估结果"><a href="#评估结果" class="headerlink" title="评估结果"></a>评估结果</h4><ul>
<li><strong>MiniCPM-2.4B</strong>：在多个基准测试中表现优异，特别是在中文任务中表现优于Mistral-7B。</li>
<li><strong>MiniCPM-1.2B</strong>：在多个基准测试中也表现出色，特别是在直接生成任务中表现优于PPL测试。</li>
</ul>
<p>通过这些详细的介绍，可以看出MiniCPM模型在设计、训练和评估方面都经过了精心考虑和优化，取得了显著的性能提升。</p>
<h2 id="5-MiniCPM-家族模型"><a href="#5-MiniCPM-家族模型" class="headerlink" title="5. MiniCPM 家族模型"></a>5. MiniCPM 家族模型</h2><p>论文介绍了基于MiniCPM基础模型的几种扩展模型，包括MiniCPM-DPO、MiniCPM-128K和MiniCPM-MoE。这些模型在各自的应用领域中展示了卓越的性能。以下是该章节的详细介绍：</p>
<h3 id="5-1-MiniCPM-DPO"><a href="#5-1-MiniCPM-DPO" class="headerlink" title="5.1 MiniCPM-DPO"></a>5.1 MiniCPM-DPO</h3><p><img src="https://raw.githubusercontent.com/chongzicbo/images/main/picgo/image-20241223154302859.png" srcset="/img/loading.gif" lazyload alt="image-20241223154302859"></p>
<p><img src="https://raw.githubusercontent.com/chongzicbo/images/main/picgo/image-20241223154345626.png" srcset="/img/loading.gif" lazyload alt="image-20241223154345626"></p>
<ul>
<li><strong>背景</strong>：在微调阶段之后，使用DPO（Direct Preference Optimization）进行人类偏好对齐。</li>
<li><strong>训练</strong>：使用UltraFeedback作为主要对齐数据集，并构建了一个专有的偏好数据集以增强模型的代码和数学能力。</li>
<li><strong>结果</strong>：在MTBench上的得分从SFT后的6.89提高到7.25，超过了像Llama2-70B-Chat这样的大型模型。然而，基准测试结果略有下降，这是对齐税（alignment tax）的表现。</li>
</ul>
<h3 id="5-2-MiniCPM-128K"><a href="#5-2-MiniCPM-128K" class="headerlink" title="5.2 MiniCPM-128K"></a>5.2 MiniCPM-128K</h3><p><img src="https://raw.githubusercontent.com/chongzicbo/images/main/picgo/image-20241223154425567.png" srcset="/img/loading.gif" lazyload alt="image-20241223154425567"></p>
<ul>
<li><strong>背景</strong>：处理长上下文任务需要模型能够隐含地理解长文本中的信息。</li>
<li><strong>初始化</strong>：禁用输入和输出之间的嵌入共享，以适应长上下文训练所需的词汇并行性。</li>
<li><strong>训练</strong>：使用WSD学习率调度器，训练数据分为“短数据”和“长数据”，长数据占44%，短数据占56%。使用Adjusted Base Frequency (ABF)和NTK-Aware RoPE Scaling进行扩展。</li>
<li><strong>评估</strong>：在∞Bench基准测试中表现优异，特别是在长上下文推理任务中，超越了ChatGLM3-6B-128K。</li>
</ul>
<h3 id="5-3-MiniCPM-MoE"><a href="#5-3-MiniCPM-MoE" class="headerlink" title="5.3 MiniCPM-MoE"></a>5.3 MiniCPM-MoE</h3><p><img src="https://raw.githubusercontent.com/chongzicbo/images/main/picgo/image-20241223154445784.png" srcset="/img/loading.gif" lazyload alt="image-20241223154445784"></p>
<ul>
<li><strong>背景</strong>：通过混合专家（MoE）技术扩展MiniCPM的能力。</li>
<li><strong>初始化</strong>：使用Sparse Upcycling进行初始化，将密集模型的每个MLP层替换为MoE层，路由参数随机初始化。</li>
<li><strong>训练</strong>：使用WSD学习率调度器，训练批量大小在稳定和衰减阶段为4M，在SFT阶段减少到2M。</li>
<li><strong>结果</strong>：在多个基准测试中表现优异，特别是在C-Eval、CMMLU、MMLU、HumanEval、MBPP、GSM8K和MATH等任务上。</li>
</ul>
<p>MiniCPM家族的扩展模型在各自的领域中展示了卓越的性能，证明了MiniCPM在多样化的SLM应用中的潜力。未来的研究方向包括深入分析衰减阶段的损失下降，并通过扩展模型规模和数据规模来增强MiniCPM的能力。</p>
<h2 id="6-研究结论"><a href="#6-研究结论" class="headerlink" title="6. 研究结论"></a>6. 研究结论</h2><ul>
<li>MiniCPM 系列模型展示了小型语言模型在资源效率和性能上的巨大潜力。通过创新的训练方法和架构设计，MiniCPM 不仅在小型模型中表现出色，还能够与大型模型相媲美。WSD 学习率调度器的引入为模型的持续训练和数据-模型缩放规律的研究提供了新的思路。此外，MiniCPM 家族的多样化模型进一步巩固了其在不同应用场景中的基础地位。</li>
</ul>
<h2 id="7-论文研究的不足"><a href="#7-论文研究的不足" class="headerlink" title="7. 论文研究的不足"></a>7. 论文研究的不足</h2><p>尽管 MiniCPM 在小型语言模型的研究中取得了显著进展，但仍存在一些不足之处：</p>
<ol>
<li><strong>未验证在大型模型上的应用</strong>：论文主要集中在小型模型的研究上，尚未验证 WSD 调度器在大型模型上的应用效果。</li>
<li><strong>缺乏对损失下降机制的深入分析</strong>：尽管 WSD 调度器在 Decay 阶段表现出色，但其背后的机制尚未得到深入分析，未来需要进一步研究。</li>
<li><strong>未考虑实际部署中的优化</strong>：虽然 MiniCPM 在资源效率上表现出色，但在实际部署中，仍需进一步优化以适应不同的硬件环境。</li>
</ol>
<h2 id="8-论文评价"><a href="#8-论文评价" class="headerlink" title="8.论文评价"></a>8.论文评价</h2><h3 id="优点与创新"><a href="#优点与创新" class="headerlink" title="优点与创新"></a>优点与创新</h3><ol>
<li><strong>MiniCPM模型系列</strong>：论文介绍了MiniCPM系列小型语言模型，包括1.2B和2.4B非嵌入参数变体，这些模型在各自的小规模类别中表现卓越，并且与7B-13B大型语言模型的能力相当。</li>
<li><strong>可扩展性</strong>：研究展示了在模型和数据维度上的可扩展性，为未来的大型语言模型（LLM）研究提供了潜力。</li>
<li><strong>模型风洞实验</strong>：通过广泛的模型风洞实验，确保了稳定和最优的模型扩展。</li>
<li><strong>温暖的稳定衰减（WSD）学习率调度器（LRS）</strong>：引入了WSD LRS，有利于连续训练和领域适应，并能够高效地研究数据-模型扩展规律。</li>
<li><strong>训练动态分析</strong>：对WSD LRS的训练动态进行了深入分析，揭示了模型预训练的有趣损失景观。</li>
<li><strong>更高的计算最优数据-模型比率</strong>：通过WSD LRS，能够在模型轴上线性努力，在数据轴上忽略不计的努力，从而得出比Chinchilla Optimal更高的计算最优数据-模型比率。</li>
<li><strong>MiniCPM家族</strong>：介绍了MiniCPM家族，包括MiniCPM-DPO、MiniCPM-MoE和MiniCPM-128K，进一步巩固了MiniCPM在多样化小型语言模型应用中的基础。</li>
<li><strong>公开可用</strong>：MiniCPM模型系列公开发布，便于其他研究人员使用和改进。</li>
</ol>
<h3 id="不足与反思"><a href="#不足与反思" class="headerlink" title="不足与反思"></a>不足与反思</h3><ol>
<li><strong>未扩展到大型语言模型</strong>：尽管研究了小型语言模型的扩展规律，但论文并未扩展到训练大型语言模型以验证扩展规律。</li>
<li><strong>WSD LRS在大型语言模型上的应用未完全探索</strong>：尽管对WSD LRS在大型语言模型上的潜在优势保持乐观，但目前尚未完全探索其在大型语言模型上的应用。</li>
</ol>
<h2 id="9-关键问题及回答"><a href="#9-关键问题及回答" class="headerlink" title="9. 关键问题及回答"></a>9. 关键问题及回答</h2><h3 id="问题1：MiniCPM模型在模型风洞实验中是如何进行超参数优化的？"><a href="#问题1：MiniCPM模型在模型风洞实验中是如何进行超参数优化的？" class="headerlink" title="问题1：MiniCPM模型在模型风洞实验中是如何进行超参数优化的？"></a><strong>问题1：MiniCPM模型在模型风洞实验中是如何进行超参数优化的？</strong></h3><p>MiniCPM模型在模型风洞实验中进行了广泛的超参数优化，主要包括以下几个方面：</p>
<ol>
<li><strong>宽度缩放</strong>：使用Tensor Program技术进行宽度缩放，支持CerebrasGPT等模型在不同模型规模下的超参数一致性。</li>
<li><strong>深度缩放</strong>：同样使用Tensor Program技术进行深度缩放，尽管对于深度大于2的网络，深度缩放的效果不如预期，但实验结果显示最优学习率是稳定的。</li>
<li><strong>学习率调度器</strong>：引入了Warmup-Stable-Decay（WSD）学习率调度器，适用于连续训练和领域适应。WSD调度器将训练阶段明确分为高学习率阶段和衰减阶段。</li>
</ol>
<p>通过这些超参数优化技术，MiniCPM模型能够在不同模型规模下实现稳定的训练和优化。</p>
<h3 id="问题2：Warmup-Stable-Decay（WSD）学习率调度器在MiniCPM模型中的具体实现和效果如何？"><a href="#问题2：Warmup-Stable-Decay（WSD）学习率调度器在MiniCPM模型中的具体实现和效果如何？" class="headerlink" title="问题2：Warmup-Stable-Decay（WSD）学习率调度器在MiniCPM模型中的具体实现和效果如何？"></a><strong>问题2：Warmup-Stable-Decay（WSD）学习率调度器在MiniCPM模型中的具体实现和效果如何？</strong></h3><p>Warmup-Stable-Decay（WSD）学习率调度器在MiniCPM模型中的具体实现如下：</p>
<ol>
<li><strong>高学习率阶段</strong>：模型在初始阶段采用较高的学习率进行训练，以便快速找到全局最优解。</li>
<li><strong>衰减阶段</strong>：当学习率达到一定值后，学习率逐渐减小，直至达到最小值。这一阶段的学习率衰减是线性的，并且在衰减结束后保持恒定。</li>
<li><strong>连续训练</strong>：WSD调度器允许模型在衰减阶段之后继续进行训练，从而实现连续训练。</li>
</ol>
<p>效果方面，WSD调度器在MiniCPM模型中表现出显著的优势：</p>
<ol>
<li><strong>损失降低</strong>：在衰减阶段，学习率的突然减小导致损失显著下降，并且损失迅速降至与Cosine LRS相当的水平。</li>
<li><strong>连续训练</strong>：通过WSD调度器，模型可以在衰减阶段之后继续训练，达到与较大模型相似的性能，同时节省了大量的计算资源。</li>
<li><strong>数据-模型缩放定律</strong>：WSD调度器使得研究数据-模型缩放定律变得更加高效，能够在模型轴和数据轴上以线性努力进行研究。</li>
</ol>
<h3 id="问题3：MiniCPM家族中的其他成员（如MiniCPM-DPO、MiniCPM-128K和MiniCPM-MoE）有哪些具体功能和表现？"><a href="#问题3：MiniCPM家族中的其他成员（如MiniCPM-DPO、MiniCPM-128K和MiniCPM-MoE）有哪些具体功能和表现？" class="headerlink" title="问题3：MiniCPM家族中的其他成员（如MiniCPM-DPO、MiniCPM-128K和MiniCPM-MoE）有哪些具体功能和表现？"></a><strong>问题3：MiniCPM家族中的其他成员（如MiniCPM-DPO、MiniCPM-128K和MiniCPM-MoE）有哪些具体功能和表现？</strong></h3><p>MiniCPM家族中的其他成员包括MiniCPM-DPO、MiniCPM-128K和MiniCPM-MoE，它们各自具有不同的功能和表现：</p>
<ol>
<li><strong>MiniCPM-DPO</strong>：在SFT阶段之后，MiniCPM-DPO通过DPO（Direct Preference Optimization）进行人类偏好对齐。使用UltraFeedback作为主要对齐数据集，并构建了一个专有的偏好数据集以增强模型的代码和数学能力。在MTBench基准测试中，MiniCPM-DPO的性能从SFT后的6.89提高到7.25，超过了多个较大的模型。</li>
<li><strong>MiniCPM-128K</strong>：将MiniCPM-2.4B的上下文长度从4096扩展到128,000 tokens，展示了小型语言模型在处理长上下文任务中的能力。通过调整基础频率和使用NTK-Aware RoPE Scaling等技术，MiniCPM-128K在∞Bench基准测试中取得了与Mistral-7B-Instruct-v0.2相当的结果，尽管其模型规模较小。</li>
<li><strong>MiniCPM-MoE</strong>：通过引入Mixture-of-Expert（MoE），MiniCPM-MoE进一步扩展了MiniCPM的能力。MoE模型在每个token上激活两个专家，并使用Router参数进行路由。在MBPP基准测试中，MiniCPM-MoE的性能与Llama2-34B相当，表明其在多任务语言理解方面的强大能力。</li>
</ol>
<p>文章合集：<a target="_blank" rel="noopener" href="https://github.com/chongzicbo/ReadWriteThink">https://github.com/chongzicbo/ReadWriteThink</a></p>
<p><img src="https://raw.githubusercontent.com/chongzicbo/images/main/picgo/%E4%BA%8C%E7%BB%B4%E7%A0%81.jpg" srcset="/img/loading.gif" lazyload alt="微信公众号"></p>

                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
    <div class="post-meta mr-3 d-flex align-items-center">
      <i class="iconfont icon-category"></i>
      

<span class="category-chains">
  
  
    
      <span class="category-chain">
        
  <a href="/categories/%E4%BA%BA%E5%B7%A5%E6%99%BA%E8%83%BD/" class="category-chain-item">人工智能</a>
  
  
    <span>></span>
    
  <a href="/categories/%E4%BA%BA%E5%B7%A5%E6%99%BA%E8%83%BD/multi-modal/" class="category-chain-item">multi-modal</a>
  
  

  

      </span>
    
  
</span>

    </div>
  
  
    <div class="post-meta">
      <i class="iconfont icon-tags"></i>
      
        <a href="/tags/%E4%BA%BA%E5%B7%A5%E6%99%BA%E8%83%BD/" class="print-no-link">#人工智能</a>
      
        <a href="/tags/%E5%A4%9A%E6%A8%A1%E6%80%81/" class="print-no-link">#多模态</a>
      
        <a href="/tags/%E8%AE%BA%E6%96%87%E9%98%85%E8%AF%BB/" class="print-no-link">#论文阅读</a>
      
    </div>
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>MiniCPM详解</div>
      <div>https://chongzicbo.github.io/2024/12/20/人工智能/multi-modal/论文阅读14：MiniCPM深入解析/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>Author</div>
          <div>程博</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>Posted on</div>
          <div>December 20, 2024</div>
        </div>
      
      
      
        <div class="license-meta-item">
          <div>Licensed under</div>
          <div>
            
              
              
                <a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
                  <span class="hint--top hint--rounded" aria-label="BY - Attribution">
                    <i class="iconfont icon-cc-by"></i>
                  </span>
                </a>
              
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2024/12/21/%E5%BC%80%E5%8F%91/Python/Python-004%EF%BC%9APython%20%E6%97%A5%E5%BF%97%E5%A4%84%E7%90%86%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5%EF%BC%9A%E4%BD%BF%E7%94%A8loguru%E6%A8%A1%E5%9D%97%E6%9E%84%E5%BB%BA%E9%AB%98%E6%95%88%E6%97%A5%E5%BF%97%E7%B3%BB%E7%BB%9F/" title="Python 日志处理最佳实践：使用loguru模块构建高效日志系统">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">Python 日志处理最佳实践：使用loguru模块构建高效日志系统</span>
                        <span class="visible-mobile">Previous</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2024/12/19/%E5%BC%80%E5%8F%91/cpp/C++001%EF%BC%9AC++%E5%8F%B3%E5%80%BC%E8%AF%AD%E4%B9%89%E8%AF%A6%E8%A7%A3%EF%BC%9A%E4%BB%8E%E5%9F%BA%E7%A1%80%E5%88%B0%E5%AE%9E%E6%88%98/" title="C++ 右值语义详解：从基础到实战">
                        <span class="hidden-mobile">C++ 右值语义详解：从基础到实战</span>
                        <span class="visible-mobile">Next</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar category-bar" style="margin-left: -1rem">
    





<div class="category-list">
  
  
    
    
    
    <div class="category row nomargin-x">
      <a class="category-item 
          list-group-item category-item-action col-10 col-md-11 col-xm-11" title="人工智能"
        id="heading-f068f0dad74789bee210163c40a4b50d" role="tab" data-toggle="collapse" href="#collapse-f068f0dad74789bee210163c40a4b50d"
        aria-expanded="true"
      >
        人工智能
        <span class="list-group-count">(8)</span>
        <i class="iconfont icon-arrowright"></i>
      </a>
      
      <div class="category-collapse collapse show" id="collapse-f068f0dad74789bee210163c40a4b50d"
           role="tabpanel" aria-labelledby="heading-f068f0dad74789bee210163c40a4b50d">
        
        
          
          
  <div class="category-post-list">
    
    
  </div>

          
  
    
    
    
    <div class="category-sub row nomargin-x">
      <a class="category-subitem collapsed
          list-group-item category-item-action col-10 col-md-11 col-xm-11" title="computer-vision"
        id="heading-a82f3db817c535a4bae230a7ce1aebdd" role="tab" data-toggle="collapse" href="#collapse-a82f3db817c535a4bae230a7ce1aebdd"
        aria-expanded="false"
      >
        computer-vision
        <span class="list-group-count">(3)</span>
        <i class="iconfont icon-arrowright"></i>
      </a>
      
      <div class="category-collapse collapse " id="collapse-a82f3db817c535a4bae230a7ce1aebdd"
           role="tabpanel" aria-labelledby="heading-a82f3db817c535a4bae230a7ce1aebdd">
        
        
          
  <div class="category-post-list">
    
    
      
      
        <a href="/2024/12/07/%E4%BA%BA%E5%B7%A5%E6%99%BA%E8%83%BD/computer-vision/CV010-YOLO%20V10%E8%AF%A6%E8%A7%A3/" title="YOLO V10 详解"
           class="list-group-item list-group-item-action
           ">
          <span class="category-post">YOLO V10 详解</span>
        </a>
      
    
      
      
        <a href="/2024/12/07/%E4%BA%BA%E5%B7%A5%E6%99%BA%E8%83%BD/computer-vision/CV007-YOLO11%E8%AF%A6%E8%A7%A3/" title="YOLO11 详解"
           class="list-group-item list-group-item-action
           ">
          <span class="category-post">YOLO11 详解</span>
        </a>
      
    
      
      
        <a href="/2024/12/07/%E4%BA%BA%E5%B7%A5%E6%99%BA%E8%83%BD/computer-vision/CV008-%E8%AF%84%E4%BC%B0%20YOLO%20%EF%BC%88You%20Only%20Look%20Once%EF%BC%89%20%E6%A8%A1%E5%9E%8B%E7%9A%84%E6%BC%94%E5%8F%98%EF%BC%9AYOLO11%20%E5%8F%8A%E5%85%B6%E5%89%8D%E8%BA%AB%E7%9A%84%E5%85%A8%E9%9D%A2%E5%9F%BA%E5%87%86%E7%A0%94%E7%A9%B6/" title="YOLO模型的全面综述"
           class="list-group-item list-group-item-action
           ">
          <span class="category-post">YOLO模型的全面综述</span>
        </a>
      
    
  </div>

        
      </div>
    </div>
  
    
    
    
    <div class="category-sub row nomargin-x">
      <a class="category-subitem 
          list-group-item category-item-action col-10 col-md-11 col-xm-11" title="multi-modal"
        id="heading-8bef24fd03b0b8fe8de0c18ea7f6c1fe" role="tab" data-toggle="collapse" href="#collapse-8bef24fd03b0b8fe8de0c18ea7f6c1fe"
        aria-expanded="true"
      >
        multi-modal
        <span class="list-group-count">(2)</span>
        <i class="iconfont icon-arrowright"></i>
      </a>
      
      <div class="category-collapse collapse show" id="collapse-8bef24fd03b0b8fe8de0c18ea7f6c1fe"
           role="tabpanel" aria-labelledby="heading-8bef24fd03b0b8fe8de0c18ea7f6c1fe">
        
        
          
          
  <div class="category-post-list">
    
    
      
      
        <a href="/2024/12/20/%E4%BA%BA%E5%B7%A5%E6%99%BA%E8%83%BD/multi-modal/%E8%AE%BA%E6%96%87%E9%98%85%E8%AF%BB14%EF%BC%9AMiniCPM%E6%B7%B1%E5%85%A5%E8%A7%A3%E6%9E%90/" title="MiniCPM详解"
           class="list-group-item list-group-item-action
           active">
          <span class="category-post">MiniCPM详解</span>
        </a>
      
    
  </div>

          
  
    
    
    
    <div class="category-sub row nomargin-x">
      <a class="category-subitem collapsed
          list-group-item category-item-action col-10 col-md-11 col-xm-11" title="OCR"
        id="heading-f529c51ee65a122778f148485732aee5" role="tab" data-toggle="collapse" href="#collapse-f529c51ee65a122778f148485732aee5"
        aria-expanded="false"
      >
        OCR
        <span class="list-group-count">(1)</span>
        <i class="iconfont icon-arrowright"></i>
      </a>
      
      <div class="category-collapse collapse " id="collapse-f529c51ee65a122778f148485732aee5"
           role="tabpanel" aria-labelledby="heading-f529c51ee65a122778f148485732aee5">
        
        
          
  <div class="category-post-list">
    
    
      
      
        <a href="/2024/12/17/%E4%BA%BA%E5%B7%A5%E6%99%BA%E8%83%BD/multi-modal/OCR/%E5%A4%9A%E6%A8%A1%E6%80%81003%EF%BC%9AOCR%E7%AE%97%E6%B3%95%E3%80%81%E6%A8%A1%E5%9E%8B%E7%BB%BC%E8%BF%B0/" title="OCR算法、模型综述"
           class="list-group-item list-group-item-action
           ">
          <span class="category-post">OCR算法、模型综述</span>
        </a>
      
    
  </div>

        
      </div>
    </div>
  
        
      </div>
    </div>
  
    
    
    
    <div class="category-sub row nomargin-x">
      <a class="category-subitem collapsed
          list-group-item category-item-action col-10 col-md-11 col-xm-11" title="nlp"
        id="heading-4c5adbed16b4c9d16698f71cca4218cb" role="tab" data-toggle="collapse" href="#collapse-4c5adbed16b4c9d16698f71cca4218cb"
        aria-expanded="false"
      >
        nlp
        <span class="list-group-count">(3)</span>
        <i class="iconfont icon-arrowright"></i>
      </a>
      
      <div class="category-collapse collapse " id="collapse-4c5adbed16b4c9d16698f71cca4218cb"
           role="tabpanel" aria-labelledby="heading-4c5adbed16b4c9d16698f71cca4218cb">
        
        
          
          
  <div class="category-post-list">
    
    
      
      
        <a href="/2024/12/07/%E4%BA%BA%E5%B7%A5%E6%99%BA%E8%83%BD/nlp/NLP025-huggingface%E8%87%AA%E5%AE%9A%E4%B9%89%E6%95%B0%E6%8D%AE%E9%9B%86%E5%92%8C%E6%A8%A1%E5%9E%8B%E4%B8%8B%E8%BD%BD%E5%AD%98%E5%82%A8%E7%9B%AE%E5%BD%95/" title="transformers自定义数据集"
           class="list-group-item list-group-item-action
           ">
          <span class="category-post">transformers自定义数据集</span>
        </a>
      
    
  </div>

          
  
    
    
    
    <div class="category-sub row nomargin-x">
      <a class="category-subitem collapsed
          list-group-item category-item-action col-10 col-md-11 col-xm-11" title="llm"
        id="heading-dae1be85dab3650eb56b87c4e3390387" role="tab" data-toggle="collapse" href="#collapse-dae1be85dab3650eb56b87c4e3390387"
        aria-expanded="false"
      >
        llm
        <span class="list-group-count">(2)</span>
        <i class="iconfont icon-arrowright"></i>
      </a>
      
      <div class="category-collapse collapse " id="collapse-dae1be85dab3650eb56b87c4e3390387"
           role="tabpanel" aria-labelledby="heading-dae1be85dab3650eb56b87c4e3390387">
        
        
          
  <div class="category-post-list">
    
    
      
      
        <a href="/2024/12/26/%E4%BA%BA%E5%B7%A5%E6%99%BA%E8%83%BD/nlp/llm/%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90%EF%BC%9Allama3%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90-01%EF%BC%9A%E6%95%B4%E4%BD%93%E4%BB%A3%E7%A0%81%E7%BB%93%E6%9E%84%E5%8F%8A%E6%A8%A1%E5%9D%97%E5%8A%9F%E8%83%BD/" title="llama3源码解析-01：整体代码结构及模块功能"
           class="list-group-item list-group-item-action
           ">
          <span class="category-post">llama3源码解析-01：整体代码结构及模块功能</span>
        </a>
      
    
      
      
        <a href="/2024/12/26/%E4%BA%BA%E5%B7%A5%E6%99%BA%E8%83%BD/nlp/llm/%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90%EF%BC%9Allama3%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90-02%EF%BC%9Atokenizer%E6%A8%A1%E5%9D%97%E8%A7%A3%E6%9E%90/" title="llama3源码解析-02：tokenizer模块解析"
           class="list-group-item list-group-item-action
           ">
          <span class="category-post">llama3源码解析-02：tokenizer模块解析</span>
        </a>
      
    
  </div>

        
      </div>
    </div>
  
        
      </div>
    </div>
  
        
      </div>
    </div>
  
</div>


  </aside>


    </div>
  </div>
</div>





  



  



  



  



  


  
  





  <script>
  Fluid.utils.createScript('https://lib.baomitu.com/mermaid/8.14.0/mermaid.min.js', function() {
    mermaid.initialize({"theme":"default"});

    Fluid.utils.listenDOMLoaded(function() {
      Fluid.events.registerRefreshCallback(function() {
        if ('mermaid' in window) {
          mermaid.init();
        }
      });
    });
  });
</script>






    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">Search</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">Keyword</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://github.com/chongzicbo" target="_blank" rel="nofollow noopener"><span>Github</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
    </div>
  
  
    <div class="statistics">
  
  

  
    
      <span id="busuanzi_container_site_pv" style="display: none">
        总访问量 
        <span id="busuanzi_value_site_pv"></span>
         次
      </span>
    
    
      <span id="busuanzi_container_site_uv" style="display: none">
        总访客数 
        <span id="busuanzi_value_site_uv"></span>
         人
      </span>
    
    

  

</div>

  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.4/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.20.1/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/5.0.0/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  
      <script>
        if (!window.MathJax) {
          window.MathJax = {
            tex    : {
              inlineMath: { '[+]': [['$', '$']] }
            },
            loader : {
              load: ['ui/lazy']
            },
            options: {
              renderActions: {
                insertedScript: [200, () => {
                  document.querySelectorAll('mjx-container').forEach(node => {
                    let target = node.parentNode;
                    if (target.nodeName.toLowerCase() === 'li') {
                      target.parentNode.classList.add('has-jax');
                    }
                  });
                }, '', false]
              }
            }
          };
        } else {
          MathJax.startup.document.state(0);
          MathJax.texReset();
          MathJax.typeset();
          MathJax.typesetPromise();
        }

        Fluid.events.registerRefreshCallback(function() {
          if ('MathJax' in window && MathJax.startup.document && typeof MathJax.startup.document.state === 'function') {
            MathJax.startup.document.state(0);
            MathJax.texReset();
            MathJax.typeset();
            MathJax.typesetPromise();
          }
        });
      </script>
    

  <script  src="https://lib.baomitu.com/mathjax/3.2.2/es5/tex-mml-chtml.js" ></script>

  <script  src="/js/local-search.js" ></script>

  <script defer src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">Blog works best with JavaScript enabled</div>
  </noscript>
</body>
</html>
